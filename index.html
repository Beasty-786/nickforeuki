<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>For Selly ‚ù§Ô∏è</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<style>
  /* Basic */
  :root { --accent1: #ff4f81; --white-grad: #ffffff; }
  body{margin:0;overflow:hidden;background:#000;font-family:Arial,Helvetica,sans-serif}
  .bg{position:fixed;inset:0;background:#111; background-size:cover;background-position:center;filter:blur(25px) brightness(0.35);transform:scale(1.2);transition:transform 1.6s ease, background-image 0.8s ease;z-index:-2}

  /* Floating hearts */
  .particle{position:fixed;bottom:-40px;font-size:24px;opacity:0.45;filter:blur(2px);animation:floatUp linear infinite;pointer-events:none}
  @keyframes floatUp{from{transform:translateY(0)}to{transform:translateY(-110vh)}}

  /* Gift */
  .scene{height:100vh;display:flex;justify-content:center;align-items:center;background:#111122}
  .box{position:relative;width:200px;height:200px;cursor:pointer}
  .box-body{width:100%;height:100%;background:linear-gradient(145deg,#ff5c8a,#ff2e6a);border-radius:12px;box-shadow:0 30px 60px rgba(0,0,0,0.7);overflow:hidden;position:relative}
  .box-lid{position:absolute;width:100%;height:100%;background:linear-gradient(145deg,#ff5c8a,#ff2e6a);transform-origin:top;transition:0.8s ease}
  .box-bowtie{position:absolute;width:60px;height:30px;background:white;top:-15px;left:50%;transform:translateX(-50%);border-radius:50%}
  .flower{position:absolute;width:160px;left:50%;bottom:-200px;transform:translateX(-50%);transition:1s cubic-bezier(0.22,1,0.36,1)}
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}
  .shake{animation:shake 0.5s ease}
  .petal{position:absolute;font-size:18px;animation:petalFloat linear forwards}
  @keyframes petalFloat{from{transform:translateY(0) rotate(0deg);opacity:1}to{transform:translateY(-250px) rotate(360deg);opacity:0}}

  /* Carousel */
  .memory-section{display:none;height:100vh;display:flex;justify-content:center;align-items:center;perspective:1200px}
  .carousel{position:relative;width:100%;max-width:760px;height:440px;display:flex;justify-content:center;align-items:center;transform-style:preserve-3d}
  .card{position:absolute;width:320px;background:white;color:black;padding:20px;border-radius:12px;text-align:center;box-shadow:0 25px 60px rgba(0,0,0,0.6);transition:transform 0.7s cubic-bezier(0.22,1,0.36,1),filter 0.7s ease,opacity 0.7s ease}
  .card img,.card video,.card iframe{width:100%;border-radius:8px;display:block}
  .date{font-family:'Playfair Display',serif;font-weight:700;margin-top:8px}
  .caption{font-family:'Dancing Script',cursive;font-size:20px;margin-top:6px}

  /* Timeline */
  .timeline-wrapper{position:relative;margin-top:20px}
  .timeline{width:0%;height:6px;background:linear-gradient(to right,var(--accent1),var(--white-grad),var(--accent1));border-radius:10px;transition:width 3s ease}
  .milestone{position:absolute;width:140px;left:50%;transform:translateX(-50%);bottom:-90px;opacity:0;transition:opacity 0.9s ease, transform 0.7s ease;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.4)}
  .counter{font-family:'Playfair Display',serif;font-weight:700;font-size:24px;margin-top:20px}
  .heart{font-size:70px;animation:pulse 1.6s infinite;margin-top:14px}
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
  .final-title{font-family:'Playfair Display',serif;font-weight:700;font-size:26px;margin-top:10px}
  .final-text{font-family:'Dancing Script',cursive;font-size:22px;margin-top:6px}
  @media (max-width:420px){.card{width:90vw}.milestone{width:110px}}
</style>
</head>
<body>

<div class="bg" id="bg"></div>

<!-- Gift -->
<div class="scene" id="giftScene">
  <div class="box" id="giftBox" onclick="openBox()">
    <div class="box-body">
      <img src="flowers.png" id="flower" class="flower" alt="flowers">
      <div class="box-lid" id="lid"><div class="box-bowtie"></div></div>
    </div>
  </div>
</div>

<!-- Carousel / Memories -->
<div class="memory-section" id="memorySection">
  <div class="carousel" id="carousel"></div>
</div>

<!-- audio -->
<audio id="music" loop>
  <source src="athousandyears.mp3" type="audio/mpeg">
</audio>

<script>
/* -------------------------
   small helpers & globals
   ------------------------- */
const log = (...a)=>console.log(...a);
let timelineStarted = false;

/* Floating hearts */
function createParticle(){
  const p = document.createElement('div'); p.className='particle';
  p.innerHTML = Math.random()>0.5 ? '‚ù§Ô∏è' : 'üåπ';
  p.style.left = (Math.random()*100) + 'vw';
  p.style.fontSize = (18 + Math.random()*30) + 'px';
  p.style.animationDuration = (10 + Math.random()*12) + 's';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),20000);
}
setInterval(createParticle,900);

/* -------------------------
   gift -> flower -> petals
   ------------------------- */
let opened=false;
function openBox(){
  if(opened) return; opened=true;
  const box = document.getElementById('giftBox');
  const lid  = document.getElementById('lid');
  const flower = document.getElementById('flower');

  box.classList.add('shake');

  setTimeout(()=>{
    lid.style.transform = 'rotateX(-120deg)';
    setTimeout(()=>{
      flower.style.bottom = '30px';
      releasePetals();
    },400);
  },500);

  setTimeout(()=>{
    document.getElementById('giftScene').style.display='none';
    document.getElementById('memorySection').style.display='flex';
    document.getElementById('music').play().catch(()=>{ /* user must interact to allow audio on some devices */});
    initCarousel();
  },3500);
}
function releasePetals(){
  const body = document.querySelector('.box-body');
  for(let i=0;i<12;i++){
    const petal = document.createElement('div');
    petal.className = 'petal';
    petal.innerHTML = 'üå∏';
    petal.style.left = (30 + Math.random()*140) + 'px';
    petal.style.bottom = '80px';
    petal.style.animationDuration = (2 + Math.random()*2) + 's';
    body.appendChild(petal);
    setTimeout(()=>petal.remove(),4200);
  }
}

/* -------------------------
   memories data
   ------------------------- */
const memories = [
  {type:'img', src:'mem1.jpeg', date:'15 May 2024', cap:'The day we started talking.'},
  {type:'img', src:'mem2.jpeg', date:'01 Aug 2024', cap:'Girlfriend‚Äôs Day.'},
  {type:'img', src:'mem3.jpeg', date:'28 Sep 2024', cap:'Our first meet up.'},
  // VIDEO uses Streamable embed (works on iPhone)
  {type:'video', src:'https://streamable.com/e/2c6hpr', date:'15 May 2025', cap:'One year together.'},
  {type:'timeline'}
];

let current = 0;
let startX = 0;
let dragging = false;

/* -------------------------
   rendering & background
   ------------------------- */
function initCarousel(){ render(); updateBG(); }
function render(){
  const container = document.getElementById('carousel');
  container.innerHTML = '';

  memories.forEach((m,i)=>{
    const card = document.createElement('div'); card.className = 'card';
    const offset = i - current;

    // position + depth
    if(offset === 0){
      card.style.transform = 'translateX(0) scale(1) rotateY(0deg)';
      card.style.zIndex = 3; card.style.filter = 'blur(0)'; card.style.opacity = 1;
    } else if(offset === -1){
      card.style.transform = 'translateX(-360px) scale(0.82) rotateY(12deg)';
      card.style.zIndex = 2; card.style.filter = 'blur(5px)'; card.style.opacity = 0.72;
    } else if(offset === 1){
      card.style.transform = 'translateX(360px) scale(0.82) rotateY(-12deg)';
      card.style.zIndex = 2; card.style.filter = 'blur(5px)'; card.style.opacity = 0.72;
    } else {
      // keep out of sight
      card.style.opacity = 0; card.style.transform = 'translateX(0) scale(0.7) rotateY(0deg)';
    }

    // content
    if(m.type === 'img'){
      card.innerHTML = `<img src="${m.src}" alt=""><div class="date">${m.date}</div><div class="caption">${m.cap}</div>`;
    } else if(m.type === 'video'){
      // Streamable embed iframe
      card.innerHTML = `<iframe src="${m.src}" width="100%" height="220" frameborder="0" allow="autoplay; fullscreen" allowfullscreen style="border-radius:8px"></iframe>
        <div class="date">${m.date}</div><div class="caption">${m.cap}</div>`;
    } else if(m.type === 'timeline'){
      // timeline card; pass card to timeline generator
      startTimeline(card);
    }

    container.appendChild(card);
  });

  updateBG();
}

/* update blurred background image from center memory, fallback to mem3.jpeg */
function updateBG(){
  const bg = document.getElementById('bg');
  if(memories[current] && memories[current].src && memories[current].type !== 'timeline'){
    bg.style.backgroundImage = `url(${memories[current].src})`;
  } else {
    // fallback image for timeline or missing: mem3.jpeg if present
    bg.style.backgroundImage = `url(mem3.jpeg)`;
  }
}

/* -------------------------
   touch drag (follow + snap)
   ------------------------- */
document.addEventListener('touchstart', e=>{
  if(timelineStarted) return; // lock during timeline
  startX = e.touches[0].clientX;
  dragging = true;
});
document.addEventListener('touchmove', e=>{
  if(!dragging || timelineStarted) return;
  const diff = e.touches[0].clientX - startX;
  const container = document.getElementById('carousel');
  container.style.transition = 'none';
  container.style.transform = `translateX(${diff}px)`;
});
document.addEventListener('touchend', e=>{
  if(timelineStarted) return; // prevent breaking timeline
  dragging = false;
  const diff = e.changedTouches[0].clientX - startX;
  const container = document.getElementById('carousel');
  container.style.transition = 'transform 0.55s cubic-bezier(0.22,1,0.36,1)';
  container.style.transform = 'translateX(0px)';
  if(diff > 80 && current > 0) current--;
  if(diff < -80 && current < memories.length - 1) current++;
  render();
});

/* allow desktop mouse dragging (optional) */
let mouseDown = false, mouseStartX = 0;
document.addEventListener('mousedown', e=>{
  if(timelineStarted) return;
  mouseDown = true; mouseStartX = e.clientX;
});
document.addEventListener('mousemove', e=>{
  if(!mouseDown || timelineStarted) return;
  const diff = e.clientX - mouseStartX;
  const container = document.getElementById('carousel');
  container.style.transition = 'none';
  container.style.transform = `translateX(${diff}px)`;
});
document.addEventListener('mouseup', e=>{
  if(timelineStarted) return;
  mouseDown = false;
  const diff = e.clientX - mouseStartX;
  const container = document.getElementById('carousel');
  container.style.transition = 'transform 0.55s cubic-bezier(0.22,1,0.36,1)';
  container.style.transform = 'translateX(0px)';
  if(diff > 80 && current > 0) current--;
  if(diff < -80 && current < memories.length - 1) current++;
  render();
});

/* -------------------------
   timeline: sequential final3 -> final2 -> final1 (final1 stays)
   ------------------------- */
function startTimeline(card){
  if(timelineStarted) return;
  timelineStarted = true;

  const startDate = new Date('2024-05-15');
  const today = new Date();
  const totalDays = Math.max(0, Math.floor((today - startDate)/(1000*60*60*24)));

  card.innerHTML = `
    <div class="date">15 May 2024 ‚Üí Today</div>
    <div class="timeline-wrapper">
      <div class="timeline" id="line"></div>
      <img src="final3.jpeg" id="milestoneImg" class="milestone" alt="final milestone">
    </div>
    <div class="counter" id="counter">0 days</div>
  `;

  // ensure card is appended to DOM
  // animate timeline bar
  setTimeout(()=>{ const line = document.getElementById('line'); if(line) line.style.width = '100%'; }, 500);

  // smooth counter (duration-based)
  const counterEl = document.getElementById('counter');
  const duration = 3000; // ms
  const start = Date.now();
  const counterTick = setInterval(()=>{
    const progress = Math.min((Date.now() - start) / duration, 1);
    const value = Math.floor(progress * totalDays);
    if(counterEl) counterEl.innerText = value + ' days';
    if(progress === 1) clearInterval(counterTick);
  }, 30);

  // sequential milestones
  const milestone = document.getElementById('milestoneImg');

  // show final3
  setTimeout(()=>{ if(milestone) { milestone.style.opacity = '1'; milestone.style.transform = 'translateY(0)'; } }, 1400);
  // fade final3
  setTimeout(()=>{ if(milestone) milestone.style.opacity = '0'; }, 3000);

  // show final2
  setTimeout(()=>{
    if(milestone){ milestone.src = 'final2.jpeg'; milestone.style.opacity = '1'; }
  }, 3800);
  // fade final2
  setTimeout(()=>{ if(milestone) milestone.style.opacity = '0'; }, 5200);

  // show final1 and keep
  setTimeout(()=>{
    if(milestone){ milestone.src = 'final1.jpeg'; milestone.style.opacity = '1'; }
  }, 6000);

  // final reveal: heart + message + background zoom
  setTimeout(()=>{
    const bg = document.getElementById('bg');
    if(bg) bg.style.transform = 'scale(1.42)';
    card.innerHTML += `
      <div class="heart">‚ù§Ô∏è</div>
      <div class="final-title">Happy Valentine Day ‚ù§Ô∏è</div>
      <div class="final-text">Thank you for being with me.<br/>Till forever.</div>
    `;
  }, 7800);
}

/* -------------------------
   init on load: show gift first
   ------------------------- */
window.addEventListener('load', ()=> {
  // ensure background fallback
  const bg = document.getElementById('bg');
  bg.style.backgroundImage = 'url(mem3.jpeg)';
});
</script>
</body>
</html>
