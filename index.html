<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Selly ‚ù§Ô∏è</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<style>
  /* Basic */
  body{margin:0;overflow:hidden;background:#000;font-family:Arial,Helvetica,sans-serif}
  .bg{position:fixed;width:100%;height:100%;background-size:cover;background-position:center;filter:blur(25px) brightness(0.35);transform:scale(1.2);transition:2s ease;z-index:-2}

  /* Floating hearts */
  .particle{position:fixed;bottom:-40px;font-size:24px;opacity:0.45;filter:blur(2px);animation:floatUp linear infinite;pointer-events:none}
  @keyframes floatUp{from{transform:translateY(0)}to{transform:translateY(-110vh)}}

  /* Gift */
  .scene{height:100vh;display:flex;justify-content:center;align-items:center;background:#111122}
  .box{position:relative;width:200px;height:200px;cursor:pointer}
  .box-body{width:100%;height:100%;background:linear-gradient(145deg,#ff5c8a,#ff2e6a);border-radius:12px;box-shadow:0 30px 60px rgba(0,0,0,0.7);overflow:hidden;position:relative}
  .box-lid{position:absolute;width:100%;height:100%;background:linear-gradient(145deg,#ff5c8a,#ff2e6a);transform-origin:top;transition:0.8s ease}
  .box-bowtie{position:absolute;width:60px;height:30px;background:white;top:-15px;left:50%;transform:translateX(-50%);border-radius:50%}
  .flower{position:absolute;width:160px;left:50%;bottom:-200px;transform:translateX(-50%);transition:1s cubic-bezier(0.22,1,0.36,1)}
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}
  .shake{animation:shake 0.5s ease}
  .petal{position:absolute;font-size:18px;animation:petalFloat linear forwards}
  @keyframes petalFloat{from{transform:translateY(0) rotate(0deg);opacity:1}to{transform:translateY(-250px) rotate(360deg);opacity:0}}

  /* Carousel */
  .memory-section{display:none;height:100vh;display:flex;justify-content:center;align-items:center;perspective:1200px}
  .carousel{position:relative;width:100%;height:420px;display:flex;justify-content:center;align-items:center;transform-style:preserve-3d}
  .card{position:absolute;width:280px;background:white;color:black;padding:20px;border-radius:12px;text-align:center;box-shadow:0 25px 60px rgba(0,0,0,0.6);transition:transform 0.7s cubic-bezier(0.22,1,0.36,1),filter 0.7s ease,opacity 0.7s ease}
  .card img,.card video{width:100%;border-radius:8px}
  .date{font-family:'Playfair Display',serif;font-weight:700;margin-top:8px}
  .caption{font-family:'Dancing Script',cursive;font-size:22px;margin-top:6px}

  /* Timeline */
  .timeline-wrapper{position:relative;margin-top:20px}
  .timeline{width:0%;height:6px;background:linear-gradient(to right,#ff4f81,#ffffff,#ff4f81);border-radius:10px;transition:3s ease}
  .milestone{position:absolute;width:140px;left:50%;transform:translateX(-50%);bottom:-90px;opacity:0;transition:1s ease;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.4)}
  .counter{font-family:'Playfair Display',serif;font-weight:700;font-size:24px;margin-top:20px}
  .heart{font-size:70px;animation:pulse 1.6s infinite}
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
  .final-title{font-family:'Playfair Display',serif;font-weight:700;font-size:26px;margin-top:15px}
  .final-text{font-family:'Dancing Script',cursive;font-size:24px;margin-top:6px}
  /* small screen tweaks */
  @media (max-width:420px){.card{width:90vw}.milestone{width:110px}}
</style>
</head>
<body>

<div class="bg" id="bg"></div>

<!-- Gift -->
<div class="scene" id="giftScene">
  <div class="box" id="giftBox" onclick="openBox()">
    <div class="box-body">
      <img src="flowers.png" id="flower" class="flower" alt="flowers">
      <div class="box-lid" id="lid"><div class="box-bowtie"></div></div>
    </div>
  </div>
</div>

<!-- Carousel / Memories -->
<div class="memory-section" id="memorySection">
  <div class="carousel" id="carousel"></div>
</div>

<!-- audio -->
<audio id="music" loop>
  <source src="athousandyears.mp3" type="audio/mpeg">
</audio>

<script>
/* floating hearts */
function createParticle(){
  const p=document.createElement('div'); p.className='particle';
  p.innerHTML = Math.random()>0.5 ? '‚ù§Ô∏è' : 'üåπ';
  p.style.left = Math.random()*100 + 'vw';
  p.style.fontSize = (20 + Math.random()*25) + 'px';
  p.style.animationDuration = (10+Math.random()*12) + 's';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),20000);
}
setInterval(createParticle,900);

/* gift flow */
let opened=false;
function openBox(){
  if(opened) return; opened=true;
  const box = document.getElementById('giftBox');
  const lid  = document.getElementById('lid');
  const flower = document.getElementById('flower');

  box.classList.add('shake');
  setTimeout(()=>{
    lid.style.transform = 'rotateX(-120deg)';
    setTimeout(()=>{
      flower.style.bottom = '30px';
      releasePetals();
    },400);
  },500);

  setTimeout(()=>{
    document.getElementById('giftScene').style.display='none';
    document.getElementById('memorySection').style.display='flex';
    const music = document.getElementById('music');
    music.play().catch(()=>{/* autoplay may be blocked until user interacts */});
    initCarousel();
  },3500);
}
function releasePetals(){
  const body = document.querySelector('.box-body');
  for(let i=0;i<12;i++){
    const petal=document.createElement('div'); petal.className='petal'; petal.innerHTML='üå∏';
    petal.style.left = (40 + Math.random()*120) + 'px';
    petal.style.bottom = '80px';
    petal.style.animationDuration = (2+Math.random()*2) + 's';
    body.appendChild(petal); setTimeout(()=>petal.remove(),4000);
  }
}

/* memories data (all start from 15 May 2024) */
const memories = [
  {type:'img', src:'mem1.jpeg', date:'15 May 2024', cap:'The day we started talking.'},
  {type:'img', src:'mem2.jpeg', date:'01 Aug 2024', cap:'Girlfriend‚Äôs Day.'},
  {type:'img', src:'mem3.jpeg', date:'28 Sep 2024', cap:'Our first meet up.'},
  {type:'video', src:'memory4.mp4', date:'15 May 2025', cap:'One year together.'},
  {type:'timeline'}
];

let current = 0;
let startX = 0;

/* render carousel: center focus, left/right blurred */
function initCarousel(){ render(); updateBG(); }
function render(){
  const container = document.getElementById('carousel');
  container.innerHTML = '';
  memories.forEach((m,i)=>{
    const card = document.createElement('div'); card.className='card';
    const offset = i - current;

    if(offset===0){
      card.style.transform = 'translateX(0) scale(1) rotateY(0deg)';
      card.style.zIndex = 3; card.style.filter='blur(0)'; card.style.opacity=1;
    } else if(offset===-1){
      card.style.transform = 'translateX(-320px) scale(0.8) rotateY(15deg)'; card.style.zIndex=2; card.style.filter='blur(5px)'; card.style.opacity=0.7;
    } else if(offset===1){
      card.style.transform = 'translateX(320px) scale(0.8) rotateY(-15deg)'; card.style.zIndex=2; card.style.filter='blur(5px)'; card.style.opacity=0.7;
    } else {
      card.style.opacity = 0;
    }

    if(m.type==='img'){
      card.innerHTML = `<img src="${m.src}" alt=""><div class="date">${m.date}</div><div class="caption">${m.cap}</div>`;
    } else if(m.type==='video'){
      card.innerHTML = `<video controls playsinline preload="metadata" style="width:100%;border-radius:8px;">
        <source src="${m.src}" type="video/mp4">
        Your browser does not support video.
      </video><div class="date">${m.date}</div><div class="caption">${m.cap}</div>`;
    } else if(m.type==='timeline'){
      // pass card to timeline function
      startTimeline(card);
    }

    container.appendChild(card);
  });
  updateBG();
}
function updateBG(){
  const bg = document.getElementById('bg');
  if(memories[current] && memories[current].src) bg.style.backgroundImage = `url(${memories[current].src})`;
}

/* smooth touch drag (follow finger + snap) */
let dragging=false;
document.addEventListener('touchstart', e=>{ startX = e.touches[0].clientX; dragging=true; });
document.addEventListener('touchmove', e=>{
  if(!dragging) return;
  const diff = e.touches[0].clientX - startX;
  const container = document.getElementById('carousel');
  container.style.transition = 'none';
  container.style.transform = `translateX(${diff}px)`;
});
document.addEventListener('touchend', e=>{
  dragging=false;
  const diff = e.changedTouches[0].clientX - startX;
  const container = document.getElementById('carousel');
  container.style.transition = 'transform 0.6s cubic-bezier(0.22,1,0.36,1)';
  container.style.transform = 'translateX(0px)';
  if(diff>80 && current>0) current--;
  if(diff<-80 && current < memories.length-1) current++;
  render();
});

/* timeline sequence: final3 -> fade, final2 -> fade, final1 stays */
function startTimeline(card){
  const startDate = new Date('2024-05-15');
  const today = new Date();
  const totalDays = Math.floor((today - startDate)/(1000*60*60*24));

  card.innerHTML = `
    <div class="date">15 May 2024 ‚Üí Today</div>
    <div class="timeline-wrapper">
      <div class="timeline" id="line"></div>
      <img src="final3.jpeg" id="milestoneImg" class="milestone" alt="final milestone">
    </div>
    <div class="counter" id="counter">0 days</div>
  `;

  const line = document.getElementById('line');
  const milestone = document.getElementById('milestoneImg');
  const counterEl = document.getElementById('counter');

  // animate bar
  setTimeout(()=>{ line.style.width = '100%'; }, 500);

  // counter
  let count = 0;
  const inc = Math.max(1, Math.ceil(totalDays/80));
  const interval = setInterval(()=>{
    count += inc;
    if(count >= totalDays){ count = totalDays; clearInterval(interval); }
    if(counterEl) counterEl.innerText = count + ' days';
  }, 40);

  // sequence: show final3, fade, final2, fade, final1 stay
  setTimeout(()=>{ milestone.style.opacity = '1'; }, 1500);
  setTimeout(()=>{ milestone.style.opacity = '0'; }, 3000);
  setTimeout(()=>{ milestone.src = 'final2.jpeg'; milestone.style.opacity='1'; }, 3800);
  setTimeout(()=>{ milestone.style.opacity = '0'; }, 5200);
  setTimeout(()=>{ milestone.src = 'final1.jpeg'; milestone.style.opacity='1'; }, 6000);

  // final reveal
  setTimeout(()=>{
    document.getElementById('bg').style.transform = 'scale(1.4)';
    card.innerHTML += `
      <div class="heart">‚ù§Ô∏è</div>
      <div class="final-title">Happy Valentine Day ‚ù§Ô∏è</div>
      <div class="final-text">Thank you for being with me.<br>Till forever.</div>
    `;
  }, 7800);
}
</script>
</body>
</html>
